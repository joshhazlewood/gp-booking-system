<div class="section">
  <div class="container">
    <div class="columns">
      <div class="column box is-8 is-offset-2">
        <ng-container *ngIf="patientFound">
          <form [formGroup]="patientForm" novalidate autocomplete="off">

            <div class="notification is-warning" *ngFor="let msg of messages; let i = index">
              <a class="delete" (click)="removeMsg(i)"></a>
              <p>{{msg}}</p>
            </div>

            <div class="columns">
              <div class="column">
                <div class="field">
                  <label class="label">Forename</label>
                  <div class="control">
                    <input class="input" type="text" formControlName="forename" [(ngModel)]="patient.forename" [attr.readonly]='isEditable === false ? true : null'
                      autocomplete="foo">
                  </div>
                </div>

                <div *ngIf="forename.errors && (forename.dirty || forename.touched)">
                  <p class="help is-danger pad-bottom" *ngIf="forename.errors.required && (forename.dirty || forename.touched)">
                    Forename is required.
                  </p>
                  <p class="help is-danger pad-bottom" *ngIf="forename.errors.minlength && !forename.pristine">
                    Forename must be at least 1 character.
                  </p>
                  <p class="help is-danger pad-bottom" *ngIf="forename.errors.maxlength && !forename.pristine">
                    Forename must be 50 characters or less.
                  </p>
                  <p class="help is-danger pad-bottom" *ngIf="forename.errors.pattern && !forename.pristine">
                    Forename cannot contain numbers.
                  </p>
                </div>

                <div class="field">
                  <label class="label">Surname</label>
                  <div class="control">
                    <input class="input" type="text" formControlName="surname" [(ngModel)]="patient.surname" [attr.readonly]='isEditable === false ? true : null'
                      autocomplete="foo">
                  </div>
                </div>

                <div *ngIf="surname.errors && (surname.dirty || surname.touched)">
                  <p class="help is-danger pad-bottom" *ngIf="surname.errors.required && (surname.dirty || surname.touched)">
                    Surname is required.
                  </p>
                  <p class="help is-danger pad-bottom" *ngIf="surname.errors.minlength && !surname.pristine">
                    Surname must be at least 1 character.
                  </p>
                  <p class="help is-danger pad-bottom" *ngIf="surname.errors.maxlength && !surname.pristine">
                    Surname must be 100 characters or less.
                  </p>
                  <p class="help is-danger pad-bottom" *ngIf="surname.errors.pattern && !surname.pristine">
                    Surname cannot contain numbers.
                  </p>
                </div>

                <div class="field">
                  <label class="label">Username/Email</label>
                  <div class="control">
                    <input class="input" type="text" formControlName="username" [(ngModel)]="patient.username" [attr.readonly]='isEditable === false ? true : null'
                      autocomplete="foo">
                  </div>
                </div>

                <div *ngIf="username.errors && (username.dirty || username.touched)">
                  <p class="help is-danger pad-bottom" *ngIf="username.errors.required">
                    Username is required.
                  </p>
                  <p class="help is-danger pad-bottom" *ngIf="username.invalid && username.value.length > 0">
                    Please enter a valid Email/Username.
                  </p>
                </div>

              </div>
              <div class="column">
                <div class="field">
                  <label class="label">Line 1</label>
                  <div class="control">
                    <input class="input" type="text" formControlName="line1" [(ngModel)]="patient.address.line1" [attr.readonly]='isEditable === false ? true : null'
                      autocomplete="foo">
                  </div>
                </div>

                <div *ngIf="line1.errors && (line1.dirty || line1.touched)">
                  <p class="help is-danger pad-bottom" *ngIf="line1.errors.required && (line1.dirty || line1.touched)">
                    Line 1 is required.
                  </p>
                  <p class="help is-danger pad-bottom" *ngIf="line1.errors.minlength && !line1.pristine">
                    Line 1 must be at least 1 character.
                  </p>
                  <p class="help is-danger pad-bottom" *ngIf="line1.errors.maxlength && !line1.pristine">
                    Line 1 must be 50 characters or less.
                  </p>
                  <p class="help is-danger pad-bottom" *ngIf="line1.errors.pattern && !line1.pristine">
                    Line 1 cannot contain numbers.
                  </p>
                </div>

                <div class="field">
                  <label class="label">Line 2</label>
                  <div class="control">
                    <input class="input" type="text" formControlName="line2" [(ngModel)]="patient.address.line2" [attr.readonly]='isEditable === false ? true : null'
                      (blur)="updateInputState('line2')" (keyup)="updateInputState('line2')" autocomplete="foo">
                  </div>
                </div>

                <div *ngIf="line2.errors && (line2.dirty || line2.touched)">
                  <p class="help is-danger pad-bottom" *ngIf="line2.errors.required && (line2.dirty || line2.touched)">
                    Line 2 is required.
                  </p>
                  <p class="help is-danger pad-bottom" *ngIf="line2.errors.minlength && !line2.pristine">
                    Line 2 must be at least 1 character.
                  </p>
                  <p class="help is-danger pad-bottom" *ngIf="line2.errors.maxlength && !line2.pristine">
                    Line 2 must be 50 characters or less.
                  </p>
                  <p class="help is-danger pad-bottom" *ngIf="line2.errors.pattern && !line2.pristine">
                    Line 2 cannot contain numbers.
                  </p>
                </div>

                <div class="field">
                  <label class="label">Town / City</label>
                  <div class="control">
                    <input class="input" type="text" formControlName="townCity" [(ngModel)]="patient.address.town_city" [attr.readonly]='isEditable === false ? true : null'
                      (blur)="updateInputState('townCity')" (keyup)="updateInputState('townCity')" autocomplete="foo">
                  </div>
                </div>

                <div *ngIf="townCity.errors && (townCity.dirty || townCity.touched)">
                  <p class="help is-danger pad-bottom" *ngIf="townCity.errors.required && (townCity.dirty || townCity.touched)">
                    Town / City is required.
                  </p>
                  <p class="help is-danger pad-bottom" *ngIf="townCity.errors.minlength && !townCity.pristine">
                    Town / City must be at least 1 character.
                  </p>
                  <p class="help is-danger pad-bottom" *ngIf="townCity.errors.maxlength && !townCity.pristine">
                    Town / City must be 50 characters or less.
                  </p>
                  <p class="help is-danger pad-bottom" *ngIf="townCity.errors.pattern && !townCity.pristine">
                    Town / City cannot contain numbers.
                  </p>
                </div>

                <div class="field">
                  <label class="label">Postcode</label>
                  <div class="control">
                    <input class="input" type="text" formControlName="postcode" [(ngModel)]="patient.address.postcode" [attr.readonly]='isEditable === false ? true : null'
                      (blur)="updateInputState('postcode')" (keyup)="updateInputState('postcode')" autocomplete="foo">
                  </div>
                </div>

                <div *ngIf="postcode.errors && (postcode.dirty || postcode.touched)">
                  <p class="help is-danger pad-bottom" *ngIf="postcode.errors.required && (postcode.dirty || postcode.touched)">
                    Postcode is required.
                  </p>
                  <p class="help is-danger pad-bottom" *ngIf="postcode.errors.minlength && !postcode.pristine">
                    Postcode must be at least 1 character.
                  </p>
                  <p class="help is-danger pad-bottom" *ngIf="postcode.errors.maxlength && !postcode.pristine">
                    Postcode must be 50 characters or less.
                  </p>
                  <p class="help is-danger pad-bottom" *ngIf="postcode.errors.pattern && !postcode.pristine">
                    Postcode cannot contain numbers.
                  </p>
                </div>

              </div>
            </div>

            <div class="buttons is-centered">
              <button class="button is-info" (click)="makeEditable()" [attr.disabled]='isEditable === true ? true : null'>Edit</button>
              <button class="button is-warning" *ngIf="isEditable === true" (click)="cancelEdit()">Cancel</button>
              <button class="button is-danger" [attr.disabled]='isEditableAndValid() === false ? true : null' (click)="saveDetails()">Save</button>
            </div>
          </form>
        </ng-container>
      </div>
    </div>
  </div>
</div>